<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>ðŸ©º Gastos MÃ©dicos â€“ Clon</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

  <style>
    body{
      font-family:'Poppins',sans-serif;
      background:linear-gradient(to right,#00416A,#E4E5E6);
      padding:20px;
    }
    h2{text-align:center;color:#003366;margin-bottom:25px}
    table{
      width:100%;
      border-collapse:collapse;
      background:#fff;
      border-radius:10px;
      overflow:hidden;
      box-shadow:0 3px 8px rgba(0,0,0,.15);
      display:block;
      max-height:80vh;
      overflow-y:auto;
    }
    th,td{
      padding:8px 10px;
      border-bottom:1px solid #ddd;
      font-size:13px;
      text-align:left;
      white-space:nowrap;
    }
    th{
      background:#003366;
      color:#fff;
      position:sticky;
      top:0;
      z-index:2;
    }
    tr:hover{background:#f3f7fb}
    .uuid{
      font-weight:600;
      color:#0c6cbd;
      font-family:monospace;
    }
    .info{
      color:#555;
    }
.icons{
  text-align:center;
  font-size:15px;
  letter-spacing:2px;
  white-space:nowrap;
}
.icons.fotos{ color:#2e7d32; }
.icons.pdf{ color:#c62828; }
.icons.xml{ color:#1565c0; }

  </style>
</head>

<body>

<h2>ðŸ©º Gastos MÃ©dicos â€“ Clon</h2>

<table>
<thead>
<tr>
  <th>Fecha</th>
  <th>UUID</th>
  <th>RazÃ³n Social</th>
  <th>Serie / Factura</th>
  <th>Total</th>
  <th>Especialidad</th>
  <th>Gasto Reclamado</th>
  <th>Fecha ReclamaciÃ³n</th>
  <th>Fotos</th>
<th>PDF</th>
<th>XML</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

<script type="module">
const supabase = window.supabase.createClient(
  "https://cvpbtjlupswbyxenugpz.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN2cGJ0amx1cHN3Ynl4ZW51Z3B6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc3MDIxOTQsImV4cCI6MjA2MzI3ODE5NH0.iiJsYM3TtaGPdeCtPcEXwAz3LfFc1uJGECEvOErvrqY"
);

const { data, error } = await supabase
  .from("xml_inge_sergio_e")
  .select("*")
  .eq("es_gasto_medico", true)
  .order("fecha", { ascending: true });

if(error){
  alert("Error al cargar datos");
  console.error(error);
}

const tbody = document.getElementById("tbody");
tbody.innerHTML = "";

data.forEach(r => {
  const tr = document.createElement("tr");
  if(r.gasto_reclamado) tr.style.background="#d7f8d7";

  const uuidCorto = r.uuid ? r.uuid.substring(0,18) + "â€¦" : "";

  tr.innerHTML = `
    <td>${r.fecha ? new Date(r.fecha).toLocaleDateString("es-MX") : ""}</td>
    <td class="uuid">${uuidCorto}</td>
    <td>${r.razon_social_emisor ?? ""}</td>
    <td>${r.serie ?? ""} - ${r.factura ?? ""}</td>
    <td>${r.total?.toLocaleString("es-MX",{style:"currency",currency:"MXN"}) ?? ""}</td>
    <td class="info">${r.especialidad ?? ""}</td>
    <td class="info">${r.gasto_reclamado ? "SÃ­" : "No"}</td>
    <td class="info">
      ${r.fecha_reclamacion ? new Date(r.fecha_reclamacion).toLocaleDateString("es-MX") : ""}
    </td>
<td class="icons fotos">${iconosFotos(r.fotos)}</td>
<td class="icons pdf">${iconoExiste(r.pdf,'ðŸ“„')}</td>
<td class="icons xml">${iconoExiste(r.xml,'ðŸ§¾')}</td>


  `;
  tbody.appendChild(tr);
});
function iconosFotos(fotos) {
  if (!Array.isArray(fotos) || fotos.length === 0) return '';
  if (fotos.length <= 4) return 'ðŸ“¸'.repeat(fotos.length);
  return 'ðŸ“¸ðŸ“¸ðŸ“¸+';
}

function iconoExiste(valor, icono) {
  return valor ? icono : '';
}

</script>

</body>
</html>
